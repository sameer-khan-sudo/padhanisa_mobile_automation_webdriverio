"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.scrollElementIntoView = exports.swipe = void 0;
const Element = __importStar(require("../element"));
const logger_1 = __importDefault(require("../logger"));
const MAGIC_NUMBER = 49;
async function swipe(elementId, percentage, direction, driver) {
    const swipeActions = [];
    const value = await driver.getElementRect(elementId);
    logger_1.default.info(`Swiping ${direction} at ${percentage}% of the element ${elementId}`);
    const pointer = getDirectionActions(direction, value, percentage);
    const actionsData = getActionsData(elementId, pointer, driver);
    swipeActions.push(actionsData);
    await driver.performActions(swipeActions);
}
exports.swipe = swipe;
async function scrollElementIntoView(config) {
    const { scrollableView, strategy, selector, percentage, direction, maxCount = 5, driver, } = config;
    for (let count = 0; count < maxCount && !(await isElementFound(driver, strategy, selector)); count++) {
        logger_1.default.info('Swiping now...');
        await swipe(scrollableView, percentage, direction, driver);
    }
}
exports.scrollElementIntoView = scrollElementIntoView;
function getDirectionActions(direction, value, percentage) {
    const { x, y } = Element.getCenter(value);
    const directionActions = {
        left: {
            sourceX: x + (value.width * MAGIC_NUMBER) / 100,
            sourceY: y,
            destinationX: (x + (value.width * MAGIC_NUMBER) / 100) * (percentage / 100),
            destinationY: y,
        },
        right: {
            sourceX: (x + (value.width * MAGIC_NUMBER) / 100) * (percentage / 100),
            sourceY: y,
            destinationX: x + (value.width * MAGIC_NUMBER) / 100,
            destinationY: y,
        },
        up: {
            sourceX: x,
            sourceY: y + (value.height * MAGIC_NUMBER) / 100,
            destinationX: x,
            destinationY: y - percentage / 100,
        },
        down: {
            sourceX: x,
            sourceY: y - percentage / 100,
            destinationX: x,
            destinationY: y + (value.height * MAGIC_NUMBER) / 100,
        },
    };
    return directionActions[direction];
}
function getActionsData(elementId, pointer, driver) {
    const actionsData = {
        id: `${elementId}`,
        type: 'pointer',
        parameters: { pointerType: 'touch' },
        actions: [
            {
                duration: 0,
                x: pointer.sourceX,
                y: pointer.sourceY,
                type: 'pointerMove',
                origin: 'viewport',
            },
            { button: 1, type: 'pointerDown' },
            { duration: 600, type: 'pause' },
            {
                duration: 600,
                x: pointer.destinationX,
                y: pointer.destinationY,
                type: 'pointerMove',
                origin: 'viewport',
            },
            { button: 1, type: 'pointerUp' },
        ],
    };
    if (driver.caps.automationName !== 'XCuiTest') {
        actionsData.actions.unshift({ duration: 0, type: 'pause' });
    }
    return actionsData;
}
async function isElementFound(driver, strategy, selector) {
    try {
        logger_1.default.info(`Checking if ${strategy} element '${selector}' is present`);
        await driver.findElement(strategy, selector);
        logger_1.default.info(`Element '${selector}' is found`);
        return true;
    }
    catch (e) {
        logger_1.default.info(`Element '${selector}' is not found`);
        return false;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3dpcGUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvZ2VzdHVyZXMvc3dpcGUuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSxvREFBc0M7QUFDdEMsdURBQTRCO0FBRTVCLE1BQU0sWUFBWSxHQUFHLEVBQUUsQ0FBQztBQUVqQixLQUFLLFVBQVUsS0FBSyxDQUFDLFNBQVMsRUFBRSxVQUFVLEVBQUUsU0FBUyxFQUFFLE1BQU07SUFDbEUsTUFBTSxZQUFZLEdBQUcsRUFBRSxDQUFDO0lBQ3hCLE1BQU0sS0FBSyxHQUFHLE1BQU0sTUFBTSxDQUFDLGNBQWMsQ0FBQyxTQUFTLENBQUMsQ0FBQztJQUNyRCxnQkFBRyxDQUFDLElBQUksQ0FBQyxXQUFXLFNBQVMsT0FBTyxVQUFVLG9CQUFvQixTQUFTLEVBQUUsQ0FBQyxDQUFDO0lBQy9FLE1BQU0sT0FBTyxHQUFHLG1CQUFtQixDQUFDLFNBQVMsRUFBRSxLQUFLLEVBQUUsVUFBVSxDQUFDLENBQUM7SUFDbEUsTUFBTSxXQUFXLEdBQUcsY0FBYyxDQUFDLFNBQVMsRUFBRSxPQUFPLEVBQUUsTUFBTSxDQUFDLENBQUM7SUFDL0QsWUFBWSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQztJQUMvQixNQUFNLE1BQU0sQ0FBQyxjQUFjLENBQUMsWUFBWSxDQUFDLENBQUM7QUFDNUMsQ0FBQztBQVJELHNCQVFDO0FBRU0sS0FBSyxVQUFVLHFCQUFxQixDQUFDLE1BQU07SUFDaEQsTUFBTSxFQUNKLGNBQWMsRUFDZCxRQUFRLEVBQ1IsUUFBUSxFQUNSLFVBQVUsRUFDVixTQUFTLEVBQ1QsUUFBUSxHQUFHLENBQUMsRUFDWixNQUFNLEdBQ1AsR0FBRyxNQUFNLENBQUM7SUFFWCxLQUNFLElBQUksS0FBSyxHQUFHLENBQUMsRUFDYixLQUFLLEdBQUcsUUFBUSxJQUFJLENBQUMsQ0FBQyxNQUFNLGNBQWMsQ0FBQyxNQUFNLEVBQUUs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