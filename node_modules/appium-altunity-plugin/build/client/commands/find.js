"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.getHierarchy = exports.getCurrentHierarchy = exports.findObject = exports.findAllObjects = exports.findObjects = void 0;
const by_1 = require("../by");
const command_helpers_1 = require("./command-helpers");
const alt_element_1 = __importDefault(require("../alt-element"));
async function findObjects(params) {
    const path = (0, command_helpers_1.getPath)(params.by, params.selector, params.contains);
    const cameraPath = (0, command_helpers_1.getPath)(this.cameraBy, this.cameraPath);
    const res = await this.sendSimpleCommand('findObjects', {
        by: params.by,
        path,
        cameraBy: this.cameraBy,
        cameraPath,
        enabled: params.enabled,
    });
    return res.map((data) => new alt_element_1.default(this, data));
}
exports.findObjects = findObjects;
async function findAllObjects(enabled = true) {
    return await this.findObjects({ by: by_1.AltBy.PATH, selector: '//*', enabled });
}
exports.findAllObjects = findAllObjects;
async function findObject(params) {
    const enabled = params.enabled ?? true;
    const path = (0, command_helpers_1.getPath)(params.by, params.selector, params.contains);
    const res = await this.sendSimpleCommand('findObject', {
        by: params.by,
        path,
        cameraBy: this.cameraBy,
        cameraPath: (0, command_helpers_1.getPath)(this.cameraBy, this.cameraPath),
        enabled,
    });
    return new alt_element_1.default(this, res);
}
exports.findObject = findObject;
function buildHierarchyFromElement(element, allEls) {
    // find all the children of this element
    const children = allEls
        .filter((child) => child.transformParentId === element.transformId)
        .map((child) => buildHierarchyFromElement(child, allEls));
    return {
        element,
        children
    };
}
async function getCurrentHierarchy() {
    const els = await this.findAllObjects();
    return await this.getHierarchy(els);
}
exports.getCurrentHierarchy = getCurrentHierarchy;
async function getHierarchy(els) {
    const rootEls = els.filter((e) => e.transformParentId === 0);
    return rootEls.map((e) => buildHierarchyFromElement(e, els));
}
exports.getHierarchy = getHierarchy;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmluZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9jbGllbnQvY29tbWFuZHMvZmluZC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7QUFDQSw4QkFBNkI7QUFDN0IsdURBQTJDO0FBQzNDLGlFQUEyRDtBQWNwRCxLQUFLLFVBQVUsV0FBVyxDQUF1QixNQUFrQjtJQUN0RSxNQUFNLElBQUksR0FBRyxJQUFBLHlCQUFPLEVBQUMsTUFBTSxDQUFDLEVBQUUsRUFBRSxNQUFNLENBQUMsUUFBUSxFQUFFLE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQTtJQUNqRSxNQUFNLFVBQVUsR0FBRyxJQUFBLHlCQUFPLEVBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUE7SUFDMUQsTUFBTSxHQUFHLEdBQUcsTUFBTSxJQUFJLENBQUMsaUJBQWlCLENBQUMsYUFBYSxFQUFFO1FBQ3BELEVBQUUsRUFBRSxNQUFNLENBQUMsRUFBRTtRQUNiLElBQUk7UUFDSixRQUFRLEVBQUUsSUFBSSxDQUFDLFFBQVE7UUFDdkIsVUFBVTtRQUNWLE9BQU8sRUFBRSxNQUFNLENBQUMsT0FBTztLQUMxQixDQUFDLENBQUE7SUFDRixPQUFPLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFRLEVBQUUsRUFBRSxDQUFDLElBQUkscUJBQVUsQ0FBQyxJQUFJLEVBQUUsSUFBc0IsQ0FBQyxDQUFDLENBQUE7QUFDOUUsQ0FBQztBQVhELGtDQVdDO0FBRU0sS0FBSyxVQUFVLGNBQWMsQ0FBdUIsVUFBbUIsSUFBSTtJQUM5RSxPQUFPLE1BQU0sSUFBSSxDQUFDLFdBQVcsQ0FBQyxFQUFDLEVBQUUsRUFBRSxVQUFLLENBQUMsSUFBSSxFQUFFLFFBQVEsRUFBRSxLQUFLLEVBQUUsT0FBTyxFQUFDLENBQUMsQ0FBQTtBQUM3RSxDQUFDO0FBRkQsd0NBRUM7QUFFTSxLQUFLLFVBQVUsVUFBVSxDQUF1QixNQUFrQjtJQUNyRSxNQUFNLE9BQU8sR0FBRyxNQUFNLENBQUMsT0FBTyxJQUFJLElBQUksQ0FBQTtJQUN0QyxNQUFNLElBQUksR0FBRyxJQUFBLHlCQUFPLEVBQUMsTUFBTSxDQUFDLEVBQUUsRUFBRSxNQUFNLENBQUMsUUFBUSxFQUFFLE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQTtJQUNqRSxNQUFNLEdBQUcsR0FBRyxNQUFNLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxZQUFZLEVBQUU7UUFDbkQsRUFBRSxFQUFFLE1BQU0sQ0FBQyxFQUFFO1FBQ2IsSUFBSTtRQUNKLFFBQVEsRUFBRSxJQUFJLENBQUMsUUFBUTtRQUN2QixVQUFVLEVBQUUsSUFBQSx5QkFBTyxFQUFDLElBQUksQ0FBQyxRQUFRLEVBQUUsSUFBSSxDQUFDLFVBQVUsQ0FBQztRQUNuRCxPQUFPO0tBQ1YsQ0FBQyxDQUFBO0lBQ0YsT0FBTyxJQUFJLHFCQUFVLENBQUMsSUFBSSxFQUFFLEdBQXFCLENBQUMsQ0FBQTtBQUN0RCxDQUFDO0FBWEQsZ0NBV0M7QUFFRCxTQUFTLHlCQUF5QixDQUFDLE9BQW1CLEVBQUUsTUFBb0I7SUFDeEUsd0NBQXdDO0lBQ3hDLE1BQU0sUUFBUSxHQUFHLE1BQU07U0FDbEIsTUFBTSxDQUFDLENBQUMsS0FBSyxFQUFFLEVBQUUsQ0FBQyxLQUFLLENBQUMsaUJBQWlCLEtBQUssT0FBTyxDQUFDLFdBQVcsQ0FBQztTQUNsRSxHQUFHLENBQUMsQ0FBQyxLQUFLLEVBQUUsRUFBRSxDQUFDLHlCQUF5QixDQUFDLEtBQUssRUFBRSxNQUFNLENBQUMsQ0FBQyxDQUFBO0lBQzdELE9BQU87UUFDSCxPQUFPO1FBQ1AsUUFBUTtLQUNYLENBQUE7QUFDTCxDQUFDO0FBRU0sS0FBSyxVQUFVLG1CQUFtQjtJQUNyQyxNQUFNLEdBQUcsR0FBRyxNQUFNLElBQUksQ0FBQyxjQUFjLEVBQUUsQ0FBQTtJQUN2QyxPQUFPLE1BQU0sSUFBSSxDQUFDLFlBQVksQ0FBQyxHQUFHLENBQUMsQ0FBQTtBQUN2QyxDQUFDO0FBSEQsa0RBR0M7QUFFTSxLQUFLLFVBQVUsWUFBWSxDQUF1QixHQUFpQjtJQUN0RSxNQUFNLE9BQU8sR0FBRyxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsaUJBQWlCLEtBQUssQ0FBQyxDQUFDLENBQUE7SUFDNUQsT0FBTyxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyx5QkFBeUIsQ0FBQyxDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQTtBQUNoRSxDQUFDO0FBSEQsb0NBR0MifQ==